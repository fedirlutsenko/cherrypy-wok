{
    "$schema": "http://json-schema.org/draft-03/schema#",
    "title": "Kimchi API",
    "description": "Json schema for Kimchi API",
    "type": "object",
    "kimchitype": {
        "graphics": {
            "description": "Configure graphics parameters for the new VM",
            "type": "object",
            "properties": {
                "type": { "enum": ["spice", "vnc"] },
                "listen": {
                    "type": [
                        {
                            "type": "string",
                            "format": "ip-address"
                        },
                        {
                            "type": "string",
                            "format": "ipv6"
                        }
                        ]
                }
            }
        }
    },
    "properties": {
        "storagepools_create": {
            "type": "object",
            "properties": {
                "name": {
                    "description": "The name of the Storage Pool",
                    "type": "string",
                    "minLength": 1,
                    "required": true
                },
                "type": {
                    "description": "The type of the defined Storage Pool",
                    "type": "string",
                    "pattern": "^dir|netfs|logical|kimchi-iso$",
                    "required": true
                },
                "path": {
                    "description": "The path of the defined Storage Pool",
                    "type": "string"
                },
                "source": {
                    "description": "Dictionary containing source information of the pool",
                    "type": "object",
                    "properties": {
                        "host": {
                            "description": "IP or hostname of server for a pool backed from a remote host",
                            "type": "string"
                        },
                        "path": {
                            "description": "Export path on NFS server for NFS pool",
                            "type": "string"
                        },
                        "devices": {
                            "description": "Array of devices to be used in the Storage Pool",
                            "type": "array",
                            "minItems": 1,
                            "uniqueItems": true,
                            "items": {
                                "description": "Full path of the block device node",
                                "type": "string"
                            }
                        },
                        "target": {
                            "description": "Target IQN of an iSCSI pool",
                            "type": "string"
                        },
                        "port": {
                            "description": "Listening port of a remote storage server",
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 65535
                        },
                        "auth": {
                            "description": "Storage back-end authentication information",
                            "type": "object",
                            "properties": {
                                "username": {
                                    "description": "Login username of the iSCSI target",
                                    "type": "string"
                                },
                                "password": {
                                    "description": "Login password of the iSCSI target",
                                    "type": "string"
                                }
                            }
                        }
                    }
                }
            }
        },
        "vms_create": {
            "type": "object",
            "properties": {
                "name": {
                    "description": "The name of the new VM",
                    "type": "string"
                },
                "template": {
                    "description": "The URI of a template to use when building a VM",
                    "type": "string",
                    "pattern": "^/templates/[^/]+/?$",
                    "required": true
                },
                "storagepool": {
                    "description": "Assign a specefic Storage Pool to the new VM",
                    "type": "string",
                    "pattern": "^/storagepools/[^/]+/?$"
                },
                "graphics": { "$ref": "#/kimchitype/graphics" }
            }
        },
        "vm_update": {
            "type": "object",
            "properties": {
                "name": {
                    "description": "New name of VM",
                    "type": "string",
                    "minLength": 1
                }
            }
        },
        "networks_create": {
            "type": "object",
            "properties": {
                "name": {
                    "description": "The name of the new network",
                    "type": "string",
                    "minLength": 1,
                    "required": true
                },
                "connection": {
                    "description": "Specifies how this network should be connected to the other networks",
                    "type": "string",
                    "pattern": "^isolated|nat|bridge$",
                    "required": true
                },
                "subnet": {
                    "description": "Network segment in slash-separated format with ip address and prefix or netmask",
                    "type": "string"
                },
                "interface": {
                    "description": "The name of a network interface on the host",
                    "type": "string"
                },
                "vlan_id": {
                    "description": "Network's VLAN ID",
                    "type": "integer",
                    "maximum": 4094,
                    "minimum": 1
                }
            }
        },
        "templates_create": {
            "type": "object",
            "properties": {
                "name": {
                    "description": "The name of the template",
                    "type": "string",
                    "pattern": "^[^ ]+( +[^ ]+)*$",
                    "minLength": 1
                },
                "icon": {
                    "description": "The template icon path",
                    "type": "string",
                    "pattern": "^images/"
                },
                "os_distro": {
                    "description": "Distribution name of the Operating System",
                    "type": "string",
                    "minLength": 1
                },
                "os_version": {
                    "description": "Version of the Operating System",
                    "type": "string",
                    "minLength": 1
                },
                "cpus": {
                    "description": "Number of CPUs for the template",
                    "type": "integer",
                    "minimum": 1
                },
                "memory": {
                    "description": "Memory (MB) for the template",
                    "type": "integer",
                    "minimum": 512
                },
                "cdrom": {
                    "description": "Path for cdrom",
                    "type": "string",
                    "pattern": "^((/)|(http)[s]?:|[t]?(ftp)[s]?:)+.*([.]iso)$",
                    "required": true
                },
                "disks": {
                    "description": "List of disks",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "index": {
                                "description": "Index of the disk",
                                "type": "integer",
                                "minimum": 0
                            },
                            "size": {
                                "description": "Size (GB) of the disk",
                                "type": "number",
                                "minimum": 1
                            }
                        }
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "storagepool": {
                    "description": "Location of the storage pool",
                    "type": "string",
                    "pattern": "^/storagepools/[^/]+/?$"
                },
                "networks": {
                    "description": "list of which networks will be assigned to the new VM.",
                    "type": "array",
                    "items": { "type": "string" },
                    "uniqueItems": true
                },
                "folder": {
                    "description": "Folder",
                    "type": "array",
                    "items": { "type": "string" }
                },
                "graphics": { "$ref": "#/kimchitype/graphics" }
            },
            "additionalProperties": false
        },
        "template_update": {
            "type": "object",
            "properties": {
                "name": {
                    "description": "The name of the template",
                    "type": "string",
                    "pattern": "^[^ ]+( +[^ ]+)*$",
                    "minLength": 1
                },
                "icon": {
                    "description": "The template icon path",
                    "type": "string",
                    "pattern": "^images/"
                },
                "os_distro": {
                    "description": "Distribution name of the Operating System",
                    "type": "string",
                    "minLength": 1
                },
                "os_version": {
                    "description": "Version of the Operating System",
                    "type": "string",
                    "minLength": 1
                },
                "cpus": {
                    "description": "Number of CPUs for the template",
                    "type": "integer",
                    "minimum": 1
                },
                "memory": {
                    "description": "Memory (MB) for the template",
                    "type": "integer",
                    "minimum": 512
                },
                "cdrom": {
                    "description": "Path for cdrom",
                    "type": "string",
                    "pattern": "^((/)|(http)[s]?:|[t]?(ftp)[s]?:)+.*([.]iso)$"
                },
                "disks": {
                    "description": "List of disks",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "index": {
                                "description": "Index of the disk",
                                "type": "integer",
                                "minimum": 0
                            },
                            "size": {
                                "description": "Size (GB) of the disk",
                                "type": "number",
                                "minimum": 1
                            }
                        }
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "storagepool": {
                    "description": "Location of the storage pool",
                    "type": "string",
                    "pattern": "^/storagepools/[^/]+/?$"
                },
                "networks": {
                    "description": "list of which networks will be assigned to the new VM.",
                    "type": "array",
                    "items": { "type": "string" },
                    "uniqueItems": true
                },
                "folder": {
                    "description": "Folder",
                    "type": "array",
                    "items": { "type": "string" }
                },
                "graphics": { "$ref": "#/kimchitype/graphics" }
            },
            "additionalProperties": false
        }
    }
}
